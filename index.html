<canvas id="canvas" width="500" height="500"></canvas>

<div> 
  <b>Horizontal Cracks: </b>
  <input type="radio" id="colorSelect1Red" name="colorSelect1" value="red" checked>
  <label for="colorSelect1Red">Red</label>
  <input type="radio" id="colorSelect1Green" name="colorSelect1" value="green">
  <label for="colorSelect1Green">Green</label>
  <input type="radio" id="colorSelect1Blue" name="colorSelect1" value="blue">
  <label for="colorSelect1Blue">Blue</label>
  <input type="radio" id="colorSelect1Transparent" name="colorSelect1" value="transparent">
  <label for="colorSelect1Transparent">Transparent</label>
</div>

<div>
  <b>Vertical Cracks: </b> 
  <input type="radio" id="colorSelect2Red" name="colorSelect2" value="red" checked>
  <label for="colorSelect2Red">Red</label>
  <input type="radio" id="colorSelect2Green" name="colorSelect2" value="green">
  <label for="colorSelect2Green">Green</label>
  <input type="radio" id="colorSelect2Blue" name="colorSelect2" value="blue">
  <label for="colorSelect2Blue">Blue</label>
  <input type="radio" id="colorSelect2Transparent" name="colorSelect2" value="transparent">
  <label for="colorSelect2Transparent">Transparent</label>
</div>

<div>
  <b>Diagonal Cracks: </b> 
  <input type="radio" id="colorSelect3Red" name="colorSelect3" value="red" checked>
  <label for="colorSelect3Red">Red</label>
  <input type="radio" id="colorSelect3Green" name="colorSelect3" value="green">
  <label for="colorSelect3Green">Green</label>
  <input type="radio" id="colorSelect3Blue" name="colorSelect3" value="blue">
  <label for="colorSelect3Blue">Blue</label>
  <input type="radio" id="colorSelect3Transparent" name="colorSelect3" value="transparent">
  <label for="colorSelect3Transparent">Transparent</label>
</div>

<script>
  var canvas = document.getElementById('canvas');
  var ctx = canvas.getContext('2d');

  var image1 = new Image();
  var image2 = new Image(); 
  var image3 = new Image(); // For vertical_crack
  var image4 = new Image(); // For diagonal_crack

  var selectedColor1 = 'red'; // Horizontal crack
  var selectedColor2 = 'red'; // Vertical crack
  var selectedColor3 = 'red'; // Diagonal crack

  image1.onload = function() {
    ctx.drawImage(image1, 0, 0, 500, 500);
    image2.src = '3masks/horizontal_crack_mask.png'; 
    image3.src = '3masks/vertical_crack_mask.png'; 
    image4.src = '3masks/diagonal_crack_mask.png'; 
  };

  image2.onload = image3.onload = image4.onload = function() {
    changeCrackColors(); 
  };

  image1.src = 'raw/S1078754.JPG';

  document.querySelectorAll('input[name="colorSelect1"]').forEach(radio => {
    radio.addEventListener('change', changeCrackColors);
  });
  document.querySelectorAll('input[name="colorSelect2"]').forEach(radio => {
    radio.addEventListener('change', changeCrackColors);
  });
  document.querySelectorAll('input[name="colorSelect3"]').forEach(radio => {
    radio.addEventListener('change', changeCrackColors);
  });

  function changeCrackColors() {
    selectedColor1 = document.querySelector('input[name="colorSelect1"]:checked').value;
    selectedColor2 = document.querySelector('input[name="colorSelect2"]:checked').value;
    selectedColor3 = document.querySelector('input[name="colorSelect3"]:checked').value;

    ctx.clearRect(0, 0, canvas.width, canvas.height); 
    ctx.drawImage(image1, 0, 0, 500, 500); 

    applyCrackColor(image2, selectedColor1); 
    applyCrackColor(image3, selectedColor2); 
    applyCrackColor(image4, selectedColor3); 
  }

  function applyCrackColor(image, color) {
    var tempCanvas = document.createElement('canvas');
    var tempCtx = tempCanvas.getContext('2d');
    tempCanvas.width = canvas.width;
    tempCanvas.height = canvas.height;

    tempCtx.drawImage(image, 0, 0, 500, 500);
    var imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
    var data = imageData.data;

    for (var i = 0; i < data.length; i += 4) {
      // Find the red pixels as mask indicators
      if (data[i] == 255 && data[i + 1] == 0 && data[i + 2] == 0) { 
        switch (color) {
          case 'red':
              data[i] = 255;
              data[i + 1] = 0;
              data[i + 2] = 0;
              break;
          case 'green':
              data[i] = 0;
              data[i + 1] = 255;
              data[i + 2] = 0;
              break;
          case 'blue':
              data[i] = 0;
              data[i + 1] = 0;
              data[i + 2] = 255;
              break;
          case 'transparent':
              data[i + 3] = 0; // Set alpha channel to fully transparent
              break;
        }
      }
    }

    // Blend with the canvas
    blendImageData(imageData); 
  }

  function blendImageData(imageData) {
    var data = imageData.data; 
    for (var i = 0; i < data.length; i += 4) {
      var alpha = data[i + 3] / 255.0; 
      ctx.fillStyle = `rgba(${data[i]}, ${data[i + 1]}, ${data[i + 2]}, ${alpha})`;
      ctx.fillRect(i / 4 % canvas.width, Math.floor(i / (4 * canvas.width)), 1, 1);
    }
  }
</script>